<!DOCTYPE html>
<html lang="en">

<head>
    <title>LiventCord</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="/static/css/main.css">


</head>
<style>
    #forgotPasswordText {
        display: flex;
        color: #13aff7;
        font-size: 15px;
        margin-top: -100px;
        display: none;
        z-index: 25;
        position: absolute;
        user-select: none;
    }


    #forgotPasswordText {
        color: #ff0000;
        font-size: 25px;
        display: none;
        z-index: 25;
        position: absolute;
        user-select: none;
    }

    #forgotPasswordText {
        display: flex;
        color: #13aff7;
        font-size: 15px;
        margin-top: -100px;
    }

    #text-center {
        margin-top: -100px;
    }
    .wrap-login100 {
        height: 400px;
    }
</style>

<body>


    <div class="limiter">
        <div class="container-login100"
            style="background-image: url('/static/images/nierforest.jpg'); background-size: cover;">

            <div class="wrap-login100">
                <form id="register-form" class="login100-form validate-form">
                    <span class="login100-form-title p-b-26">
                        Tekrar hoş geldin!
                    </span>


                    <div class="wrap-input100 validate-input" data-validate="Doğru e posta formatı: a@b.c">
                        <input class="input100" type="text" name="email">
                        <span class="focus-input100" data-placeholder="E posta"></span>
                    </div>


                    <div class="wrap-input100 validate-input" data-validate="Şifre">
                        <span class="btn-show-pass">
                            <i class="zmdi zmdi-eye"></i>
                        </span>
                        <input class="input100" type="password" name="pass">
                        <span class="focus-input100" data-placeholder="Şifre"></span>
                    </div>

                    <div class="container-login100-form-btn">
                        <div class="wrap-login100-form-btn">
                            <div class="login100-form-bgbtn"></div>
                            <button class="login100-form-btn" id="register-btn" onclick="submitForm(event)">
                                Giriş yap
                            </button>
                        </div>
                    </div>
                    <div class="forgotPasswordForm">
                        <form id="forgotPasswordForm" class="wrapForgotPasswordForm">
                            <div class="password-form-bgbtn"></div>
                            <button class="password-form-btn" id="forgotPasswordText" onclick="submitForgotPassword(event)">
                                Şifreni mi unuttun?
                            </button>
                    </form></div>

                    <div class="text-center p-t-115">
                        <a class="txt1" href="/register">
                            Bir hesaba mı ihtiyacın var?
                        </a>


                    </div>


            </div>
            </form>
        </div>
    </div>
    </div>

    <script>

        function myalert(text, isSuccess = false) {
            const container = document.createElement('div');
            let idtoadd = isSuccess ? 'info-container' : 'error-container';
            container.classList.add(idtoadd);
            container.classList.add('swipe-in');
            setTimeout(() => {
                container.classList.remove('swipe-in');
            }, 3000);

            const childDiv = document.createElement('div');
            childDiv.id = 'info-message';
            childDiv.textContent = text;

            container.appendChild(childDiv);
            document.body.prepend(container);


            setTimeout(() => {
                container.parentNode.removeChild(container);
            }, 5000);
        }

        
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function validateForgotPassParameters(email) {
            if (!email) {
                myalert('E posta geçersiz!');
                return false;
            }
            if (email === '') {
                myalert('E posta geçersiz!');
                return false;
            }
            var emailPattern = /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;
            if (!emailPattern.test(email)) {
                myalert('E posta geçersiz!');
                return false;
            }

            return true;
        }

        document.addEventListener('DOMContentLoaded', function () {
            var inputs = document.querySelectorAll('.input100');
            inputs.forEach(function(input) {

                input.addEventListener('focus', function() {
                    this.parentNode.querySelector('.focus-input100').style.display = 'none';
                });
                input.addEventListener('blur', function() {
                    if (this.value === '') {
                        this.parentNode.querySelector('.focus-input100').style.display = 'block';
                    }
                });
            });

            var inputs = [document.querySelector('input[name="email"]'),document.querySelector('input[name="pass"]') ];


            inputs.forEach((input, index) => {
                input.addEventListener("keydown", function(event) {
                    if (event.key === "Enter") {
                        event.preventDefault();
                        input.click();
                    }
                });
            });
            var emailInput = document.querySelector('input[name="email"]');
            var passwordInput = document.querySelector('input[name="pass"]');

            emailInput.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    passwordInput.focus();
                }
            });

            passwordInput.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    submitForm(event);
                }
            });

        });





        function submitForm(event) {
            event.preventDefault();
            var email = document.querySelector('input[name="email"]').value;
            var password = document.querySelector('input[name="pass"]').value;

            if (!validateEmail(email)) {
                document.querySelector('.wrap-input100.validate-input').classList.add('alert-validate');
                return;
            }
            if (!password) {
                document.querySelectorAll('.wrap-input100.validate-input')[1].classList.add('alert-validate');
                return;
            }

            var formData = new FormData();
            formData.append('email', email);
            formData.append('password', password);

            fetch('/auth/login', {
                method: 'POST',
                body: formData,
                credentials: 'same-origin'
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else if (response.status === 401) {
                        myalert('E posta veya şifre geçersiz!');
                        throw new Error('Unauthorized');
                    } else {
                        myalert('Bir hata oluştu! ' + response.status);
                        throw new Error('Error occurred');
                    }
                })
                .then(data => {
                    window.location.href = '/app';
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
        function submitForgotPassword(event) {
            event.preventDefault();
            var emailInput = document.querySelector('input.input100[name="email"]');
            var email = emailInput.value.trim();

            if (!validateEmail(email)) {
                myalert('E posta geçersiz!');
                return;
            }
            if (!validateForgotPassParameters(email)) {
                return;
            }

            var formData = new FormData();
            formData.append('email', email);

            fetch('/forgot-password', {
                method: 'POST',
                body: formData
            })
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    } else {
                        throw new Error('Failed to send reset password request');
                    }
                })
                .then(data => {
                    myalert('E posta adresinize şifre sıfırlama linki gönderildi.', isSuccess = true);
                })
                .catch(error => {
                    console.error(error);
                    myalert('Bir hata oluştu');
                });
        }






    </script>



    <body>